<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ferretería Luis - Catálogo y Gestión</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    
    <style>
        :root {
            --bg-dark: #2a2416;
            --card-dark: #f5e6d3;
            --accent-gold: #d4af37;
            --text-white: #2a2416;
            --text-muted: #8b7355;
            --border-color: #d4af37;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f5e6d3 0%, #faf0e6 100%);
            color: var(--text-white);
            margin: 0; padding: 0;
            padding-bottom: 50px;
        }

        header {
            background: linear-gradient(135deg, #d4af37 0%, #f4d03f 100%);
            padding: 20px;
            text-align: center;
            border-bottom: 3px solid #b8941e;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        header h1 {
            font-size: 2rem;
            font-weight: 700;
            color: #2a2416;
            margin: 0 0 15px 0;
        }
        nav {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        nav button, nav a {
            color: #2a2416;
            text-decoration: none;
            background: rgba(255, 255, 255, 0.3);
            border: 2px solid transparent;
            padding: 8px 15px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.3s;
        }
        nav button:hover {
            background: rgba(255, 255, 255, 0.6);
            border-color: #2a2416;
        }

        .cart-icon {
            position: fixed; top: 20px; right: 20px; z-index: 500;
            cursor: pointer; font-size: 1.8rem; color: var(--accent-gold);
            background: white; padding: 10px; border-radius: 50%; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .cart-badge {
            position: absolute; top: 0; right: 0; background: #2a2416;
            color: #d4af37; font-size: 0.7rem; padding: 2px 6px; border-radius: 50%;
        }

        .welcome-section { padding: 40px 20px; text-align: center; }
        
        .content-section { display: none; padding: 20px; }
        .content-section.active { display: block; }

        .products-grid {
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
        }
        .product-card {
            background: white; border: 2px solid var(--border-color);
            border-radius: 12px; overflow: hidden; position: relative;
            transition: 0.3s;
        }
        .product-card:hover { transform: translateY(-5px); }
        .product-img { width: 100%; height: 150px; object-fit: contain; background: #fff; padding: 5px; }
        
        .product-info { padding: 15px; text-align: center; }
        .product-name { font-weight: 700; height: 40px; overflow: hidden; font-size: 0.9rem; margin-bottom: 5px; }
        .product-price-usd { font-size: 1.2rem; font-weight: 900; color: var(--accent-gold); }
        .product-stock { font-size: 0.75rem; color: var(--text-muted); margin-bottom: 10px; }

        .btn-add-cart {
            width: 100%; padding: 10px; background: var(--accent-gold);
            color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;
        }

        /* Modales y Carrito Sidebar (Igual a tu diseño original) */
        .modal-overlay {
            position:fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(42, 36, 22, 0.9); z-index: 2000;
            display: none; justify-content: center; align-items: center;
        }
        .modal-box { background: white; padding: 25px; border-radius: 10px; width: 90%; max-width: 350px; }
        
        .cart-sidebar {
            position: fixed; top: 0; right: -100%; width: 100%; max-width: 350px;
            height: 100vh; background: white; z-index: 1000; padding: 20px;
            transition: 0.3s; border-left: 3px solid var(--accent-gold);
            display: flex; flex-direction: column;
        }
        .cart-sidebar.open { right: 0; }
        
        .sales-table { width: 100%; border-collapse: collapse; background: white; }
        .sales-table th { background: var(--accent-gold); color: white; padding: 10px; }
        .sales-table td { padding: 10px; border-bottom: 1px solid #eee; }

        .btn-delete { position: absolute; top: 5px; right: 5px; background: #dc3545; color: white; border: none; border-radius: 4px; padding: 5px; cursor: pointer; z-index: 10; }
    </style>
</head>
<body>

    <header>
        <h1>Ferretería Luis</h1>
        <nav>
            <button onclick="irSeccion('inicio')">Inicio</button>
            <button onclick="irSeccion('catalogo')">Catálogo</button>
            <button onclick="irSeccion('ventas')">Ventas</button>
            <button onclick="abrirModalTasa()"><i class="ri-exchange-dollar-line"></i> Tasa</button>
            <button onclick="abrirModalCrear()"><i class="ri-add-box-line"></i> Nuevo</button>
        </nav>
    </header>

    <div class="cart-icon" onclick="toggleCarrito()">
        <i class="ri-shopping-cart-fill"></i>
        <span class="cart-badge" id="cart-count">0</span>
    </div>

    <section id="sec-inicio" class="content-section active welcome-section">
        <h2>Panel de Control</h2>
        <p>Bienvenido, Luis. Aquí tienes el inventario cargado.</p>
        <div style="display:flex; justify-content: center; gap: 10px; margin-top: 20px;">
            <button class="btn-add-cart" style="width: auto; padding: 15px 30px;" onclick="irSeccion('catalogo')">Ir al Catálogo</button>
        </div>
    </section>

    <section id="sec-catalogo" class="content-section">
        <h2 style="text-align: center;">Catálogo de Productos</h2>
        <p style="text-align:center">Tasa actual: <strong id="info-tasa-catalogo">Cargando...</strong></p>
        <div class="products-grid" id="grid-productos"></div>
    </section>

    <section id="sec-ventas" class="content-section">
        <h2 style="text-align: center;">Registro de Ventas</h2>
        <div id="resumen-ventas" style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid var(--accent-gold);">
             <p>Total USD: <strong id="total-usd">$0.00</strong> | Total Bs: <strong id="total-bs">Bs. 0.00</strong></p>
        </div>
        <table class="sales-table">
            <thead>
                <tr>
                    <th>Fecha</th>
                    <th>Cant.</th>
                    <th>Total $</th>
                    <th>Acción</th>
                </tr>
            </thead>
            <tbody id="tabla-ventas"></tbody>
        </table>
    </section>

    <div class="modal-overlay" id="modal-tasa">
        <div class="modal-box">
            <h3>Fijar Tasa</h3>
            <input type="number" id="input-nueva-tasa" class="btn-add-cart" style="background: #eee; color: black; margin-bottom: 10px;" placeholder="Ej: 38.50">
            <button class="btn-add-cart" onclick="guardarTasa()">Guardar</button>
            <button onclick="cerrarModal('modal-tasa')" style="width: 100%; margin-top: 5px; background: none; border: none; cursor: pointer;">Cerrar</button>
        </div>
    </div>

    <div class="modal-overlay" id="modal-crear">
        <div class="modal-box">
            <h3>Nuevo Producto</h3>
            <input type="text" id="crear-nombre" placeholder="Nombre" style="width: 100%; margin-bottom: 10px; padding: 8px;">
            <input type="number" id="crear-precio" placeholder="Precio USD" style="width: 100%; margin-bottom: 10px; padding: 8px;">
            <input type="text" id="crear-url" placeholder="URL Imagen" style="width: 100%; margin-bottom: 10px; padding: 8px;">
            <button class="btn-add-cart" onclick="guardarProducto()">Guardar</button>
            <button onclick="cerrarModal('modal-crear')" style="width: 100%; margin-top: 5px; background: none; border: none; cursor: pointer;">Cancelar</button>
        </div>
    </div>

    <div class="cart-sidebar" id="carrito">
        <h2>Tu Carrito</h2>
        <div id="lista-carrito" style="flex-grow: 1; overflow-y: auto;"></div>
        <div style="border-top: 2px solid gold; padding-top: 10px;">
            <p>Total: <strong id="carrito-usd">$0.00</strong></p>
            <button class="btn-add-cart" onclick="procesarCompra()">REGISTRAR VENTA</button>
            <button onclick="toggleCarrito()" style="width: 100%; margin-top: 10px;">Cerrar</button>
        </div>
    </div>

    <script>
        let miTasa = parseFloat(localStorage.getItem('app_tasa')) || 38.00;
        let misVentas = JSON.parse(localStorage.getItem('app_ventas')) || [];
        let miCarrito = [];

        // BASE DE DATOS INICIAL (57 PRODUCTOS)
        const productosIniciales = [
            { id: 1, nombre: "Cemento", precioUSD: 14.00, stock: "Consultar", foto: "https://static.wixstatic.com/media/5a8c91_0a31865b9f3c4ca998398f7e5ced128a~mv2.png/v1/fill/w_520,h_520,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/5a8c91_0a31865b9f3c4ca998398f7e5ced128a~mv2.png" },
            { id: 2, nombre: "Pego Gris", precioUSD: 3.50, stock: "Consultar", foto: "https://imaxacero.com/wp-content/uploads/2022/06/image063.png" },
            { id: 3, nombre: "Pintura Flori Paint", precioUSD: 13.00, stock: "20", foto: "https://floripaint.com/wp-content/uploads/2024/03/CUNETE-CAUCHO-TIPO-C-scaled.jpg" },
            { id: 4, nombre: "Pinturas en Aceite / Fondo", precioUSD: 10.00, stock: "15", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTlyaVfo_ErSvS2WoMc3Z3eQEHcDru3HD2rWw&s" },
            { id: 5, nombre: "Tubo 4P", precioUSD: 15.00, stock: "20", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT_MPeZg6awcw_f2a5xOutoUQRXYPJFxu-ATQ&s" },
            { id: 6, nombre: "Tubo 3P", precioUSD: 11.00, stock: "15", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT_MPeZg6awcw_f2a5xOutoUQRXYPJFxu-ATQ&s" },
            { id: 7, nombre: "Tubo 2P", precioUSD: 7.00, stock: "20", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT_MPeZg6awcw_f2a5xOutoUQRXYPJFxu-ATQ&s" },
            { id: 8, nombre: "Tubo 1/2P", precioUSD: 10.00, stock: "Consultar", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQc2OA_dWpmvcOz-kOfLgTw7EnyMJhS6phwTg&s" },
            { id: 9, nombre: "Codo PVC 4P", precioUSD: 6.00, stock: "Consultar", foto: "https://rapikom-media.s3.amazonaws.com/panel/backend/imagenes/productos/08/16910804756330.jpg" },
            { id: 10, nombre: "Codo PVC 3P", precioUSD: 5.00, stock: "Consultar", foto: "https://rapikom-media.s3.amazonaws.com/panel/backend/imagenes/productos/08/16910804756330.jpg" },
            { id: 11, nombre: "Codo PVC 2P", precioUSD: 3.00, stock: "Consultar", foto: "https://rapikom-media.s3.amazonaws.com/panel/backend/imagenes/productos/08/16910804756330.jpg" },
            { id: 12, nombre: "Codo PVC 1/2P", precioUSD: 1.00, stock: "Consultar", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSQSxK4bNL50xbN8GU9KrW4ZY6plBOsDo26Xg&s" },
            { id: 13, nombre: "Te PVC 4P", precioUSD: 8.00, stock: "Consultar", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSZl8I0i2BnqXkowe9pjlOfA7RNCzsyh0QUAQ&s" },
            { id: 14, nombre: "Te PVC 3P", precioUSD: 6.00, stock: "Consultar", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSZl8I0i2BnqXkowe9pjlOfA7RNCzsyh0QUAQ&s" },
            { id: 15, nombre: "Te PVC 2P", precioUSD: 4.00, stock: "Consultar", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSZl8I0i2BnqXkowe9pjlOfA7RNCzsyh0QUAQ&s" },
            { id: 16, nombre: "Te PVC 1/2P", precioUSD: 1.00, stock: "Consultar", foto: "https://todoparalaindustria.com/cdn/shop/products/1767.jpg?v=1698158864&width=2048" },
            { id: 17, nombre: "Sifón PVC 2P", precioUSD: 6.00, stock: "Consultar", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR48bS7SU4vIR09KlzQwv_2t7wAgoRhmIllsw&s" },
            { id: 18, nombre: "Codo Galvanizado 1/2", precioUSD: 2.00, stock: "Consultar", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRe8M2OWQzh14o1DsklSV14bDfw1FFiQnButQ&s" },
            { id: 19, nombre: "Te Galvanizada 1/2P", precioUSD: 2.00, stock: "Consultar", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSNW8P2q8t6B6S-9m-RInF0B9Y8eM1V5FqXzA&s" },
            { id: 20, nombre: "Copa Galv. ½ a 3/8", precioUSD: 3.00, stock: "Consultar", foto: "https://http2.mlstatic.com/D_NQ_NP_2X_701635-MLV50681316937_072022-T.webp" },
            { id: 21, nombre: "Bussy Galv. 1/2P", precioUSD: 4.00, stock: "Consultar", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS5vIdroIzYURj8f4v1En6jG1KcAY0xGiifxw&s" },
            { id: 22, nombre: "Junta Dress 1/2P", precioUSD: 13.00, stock: "Consultar", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRweOrNiSkYADoUxW4EcH05PD2_I5Dz-_-OGA&s" },
            { id: 23, nombre: "Junta Dresser 3/8P", precioUSD: 15.00, stock: "Consultar", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRweOrNiSkYADoUxW4EcH05PD2_I5Dz-_-OGA&s" },
            { id: 24, nombre: "Unión Galv. 1/2P", precioUSD: 10.00, stock: "Consultar", foto: "https://www.novey.com.pa/media/catalog/product/2/3/23012023165811.jpg" },
            { id: 25, nombre: "Anillo Galv. 1/2P", precioUSD: 2.00, stock: "Consultar", foto: "https://ve.epaenlinea.com/media/catalog/product/cache/9de02ba98484dc90d74f47a4b2fb992a/a/e/ae5adc6b-3b31-4141-9eec-248dab5a4893.jpg" },
            { id: 26, nombre: "Codo PVC Plástico 1/2P", precioUSD: 1.00, stock: "Consultar", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQcfLuaAfMnJD0KQDwuPgx_OCafHvSdd9IbAg&s" },
            { id: 27, nombre: "Codo PVC Plástico 3/8P", precioUSD: 1.00, stock: "Consultar", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQcfLuaAfMnJD0KQDwuPgx_OCafHvSdd9IbAg&s" },
            { id: 28, nombre: "Te PVC Plástica 1/2P", precioUSD: 1.00, stock: "Consultar", foto: "https://todoparalaindustria.com/cdn/shop/products/1767.jpg?v=1698158864&width=2048" },
            { id: 29, nombre: "Te PVC Plástica 3/8P", precioUSD: 1.00, stock: "Consultar", foto: "https://todoparalaindustria.com/cdn/shop/products/1767.jpg?v=1698158864&width=2048" },
            { id: 30, nombre: "Cable 2x12 (Metro)", precioUSD: 3.50, stock: "Consultar", foto: "https://http2.mlstatic.com/D_NQ_NP_796729-MLV70703890859_072023-O.webp" },
            { id: 31, nombre: "Mecate (Kilo)", precioUSD: 15.00, stock: "Consultar", foto: "https://www.titaniccenter.com/cdn/shop/products/Mecate.png?v=1678737596&width=1214" },
            { id: 32, nombre: "Bombillo 15W", precioUSD: 2.00, stock: "Consultar", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSRJ3gyH9jZiBSUS_4pUO8YFAhX2pU-tEiBpw&s" },
            { id: 33, nombre: "Bombillo 40W", precioUSD: 13.00, stock: "Consultar", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTJDALo8-j8-GDJ-G6Lgo7tKakE5BJ9jqBh1A&s" },
            { id: 34, nombre: "Enchufe Hembra", precioUSD: 3.00, stock: "Consultar", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS7CSksZnJSolLlUxXN6S9O99M8MWu-58qGYw&s" },
            { id: 35, nombre: "Enchufe Macho", precioUSD: 3.00, stock: "Consultar", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTcpVw3b207fSJ-BWbBF2n9CqEMRkU7RmpUYg&s" },
            { id: 36, nombre: "Tomacorriente", precioUSD: 4.00, stock: "Consultar", foto: "https://fixtop.com.ve/ferreteria/wp-content/uploads/2021/12/80557.jpg" },
            { id: 37, nombre: "Interruptor", precioUSD: 4.00, stock: "Consultar", foto: "https://http2.mlstatic.com/D_NQ_NP_932161-MLV69115486045_042023-O.webp" },
            { id: 38, nombre: "Ramplus Verde", precioUSD: 0.80, stock: "Consultar", foto: "https://http2.mlstatic.com/D_Q_NP_2X_611512-MLV74087366632_012024-T.webp" },
            { id: 39, nombre: "Ramplus Gris", precioUSD: 0.80, stock: "Consultar", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTaiVVQX2mTNT0R_WLHNYqxDMuR1NsypuCn7g&s" },
            { id: 40, nombre: "Ramplus Naranja", precioUSD: 0.80, stock: "Consultar", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTASz4x1Oqo_7oenm5uLhN96NvloVM171StoQ&s" },
            { id: 41, nombre: "Ramplus Azul", precioUSD: 0.80, stock: "Consultar", foto: "https://http2.mlstatic.com/D_Q_NP_2X_957498-MLV46262831312_062021-T.webp" },
            { id: 42, nombre: "Brocha 1/2 Pulgada", precioUSD: 1.50, stock: "Consultar", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQoHvb88aO1KX8S-bMLW0QKAcyCx4cUJn9CgQ&s" },
            { id: 43, nombre: "Brocha 1 Pulgada", precioUSD: 2.00, stock: "Consultar", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQoHvb88aO1KX8S-bMLW0QKAcyCx4cUJn9CgQ&s" },
            { id: 44, nombre: "Brocha 2 Pulgadas", precioUSD: 3.00, stock: "Consultar", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQoHvb88aO1KX8S-bMLW0QKAcyCx4cUJn9CgQ&s" },
            { id: 45, nombre: "Brocha 3 Pulgadas", precioUSD: 4.00, stock: "Consultar", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQoHvb88aO1KX8S-bMLW0QKAcyCx4cUJn9CgQ&s" },
            { id: 46, nombre: "Brocha 4 Pulgadas", precioUSD: 5.00, stock: "Consultar", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQoHvb88aO1KX8S-bMLW0QKAcyCx4cUJn9CgQ&s" },
            { id: 47, nombre: "Brocha 6 Pulgadas", precioUSD: 6.00, stock: "Consultar", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQoHvb88aO1KX8S-bMLW0QKAcyCx4cUJn9CgQ&s" },
            { id: 48, nombre: "Rodillo Pequeño", precioUSD: 5.00, stock: "Consultar", foto: "https://http2.mlstatic.com/D_NQ_NP_855509-MLV72834478383_112023-O.webp" },
            { id: 49, nombre: "Rodillo Grande", precioUSD: 7.00, stock: "Consultar", foto: "https://yaqui.com.mx/cdn/shop/products/ROPI-910M_f366cdb7-238a-4125-86df-1e25eff21871.jpg" },
            { id: 50, nombre: "Cepillo Albañilería", precioUSD: 5.00, stock: "50", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT0ttYcdv_oHfZmmKOLRhLuWWBqJjX-gjLnZQ&s" },
            { id: 51, nombre: "Cilindro Cerradura", precioUSD: 8.00, stock: "20", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSG9atnHMtjv4cc6WEOJ_Y_R4SZAqdK5d_0HA&s" },
            { id: 52, nombre: "Pomo de Puerta", precioUSD: 15.00, stock: "10", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRwXtlDzEH1rKRp-BOa-52JE53O-HNIKdsvyw&s" },
            { id: 53, nombre: "Cerradura Cuadrada", precioUSD: 20.00, stock: "3", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTlgu7p5UN2WRWHFisEpUUY7HA9Jadym5Uk8A&s" },
            { id: 54, nombre: "Lana de acero", precioUSD: 5.00, stock: "Consultar", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQMMgglaDmZDR974tlRbporcDd1LmMNAws3mg&s" },
            { id: 55, nombre: "Pega PVC Grande", precioUSD: 5.00, stock: "Consultar", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTaTUKCzjVmLjprAucB3ks7VXKV-3D7Z3mYrw&s" },
            { id: 56, nombre: "Pega PVC Pequeña", precioUSD: 3.00, stock: "Variedad", foto: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTaTUKCzjVmLjprAucB3ks7VXKV-3D7Z3mYrw&s" },
            { id: 57, nombre: "Amarre Techo (100u)", precioUSD: 12.00, stock: "12", foto: "https://ve.epaenlinea.com/media/catalog/product/cache/9de02ba98484dc90d74f47a4b2fb992a/2/7/2730aff5-3273-409a-99f0-b3784be1650d.jpg" }
        ];

        let misProductos = JSON.parse(localStorage.getItem('app_productos')) || productosIniciales;

        window.onload = () => {
            actualizarTextosTasa();
            renderizarCatalogo();
            renderizarVentas();
        };

        function irSeccion(id) {
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            document.getElementById('sec-' + id).classList.add('active');
        }

        function renderizarCatalogo() {
            const grid = document.getElementById('grid-productos');
            grid.innerHTML = '';
            misProductos.forEach(p => {
                const precioBs = (p.precioUSD * miTasa).toFixed(2);
                grid.innerHTML += `
                    <div class="product-card">
                        <button class="btn-delete" onclick="borrarProducto(${p.id})">×</button>
                        <img src="${p.foto}" class="product-img" onerror="this.src='https://via.placeholder.com/150?text=Sin+Foto'">
                        <div class="product-info">
                            <div class="product-name">${p.nombre}</div>
                            <div class="product-price-usd">$${p.precioUSD.toFixed(2)}</div>
                            <div style="color: #2a2416; font-size: 0.85rem; font-weight: bold;">Bs. ${precioBs}</div>
                            <div class="product-stock">Stock: ${p.stock}</div>
                            <button class="btn-add-cart" onclick="agregarCarrito(${p.id})">Agregar</button>
                        </div>
                    </div>
                `;
            });
        }

        function agregarCarrito(id) {
            const p = misProductos.find(x => x.id === id);
            miCarrito.push(p);
            document.getElementById('cart-count').innerText = miCarrito.length;
            renderizarCarrito();
        }

        function renderizarCarrito() {
            const lista = document.getElementById('lista-carrito');
            lista.innerHTML = '';
            let total = 0;
            miCarrito.forEach((p, index) => {
                total += p.precioUSD;
                lista.innerHTML += `<div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                    <span>${p.nombre}</span>
                    <span>$${p.precioUSD.toFixed(2)} <button onclick="quitarCarrito(${index})" style="color:red; border:none; background:none; cursor:pointer;">×</button></span>
                </div>`;
            });
            document.getElementById('carrito-usd').innerText = `$${total.toFixed(2)}`;
        }

        function quitarCarrito(index) {
            miCarrito.splice(index, 1);
            document.getElementById('cart-count').innerText = miCarrito.length;
            renderizarCarrito();
        }

        function toggleCarrito() { document.getElementById('carrito').classList.toggle('open'); }

        function abrirModalTasa() { document.getElementById('modal-tasa').style.display = 'flex'; }
        function abrirModalCrear() { document.getElementById('modal-crear').style.display = 'flex'; }
        function cerrarModal(id) { document.getElementById(id).style.display = 'none'; }

        function guardarTasa() {
            const t = parseFloat(document.getElementById('input-nueva-tasa').value);
            if(t > 0) {
                miTasa = t;
                localStorage.setItem('app_tasa', miTasa);
                actualizarTextosTasa();
                renderizarCatalogo();
                cerrarModal('modal-tasa');
            }
        }

        function actualizarTextosTasa() {
            document.getElementById('info-tasa-catalogo').innerText = `Bs. ${miTasa.toFixed(2)}`;
        }

        function guardarProducto() {
            const nombre = document.getElementById('crear-nombre').value;
            const precio = parseFloat(document.getElementById('crear-precio').value);
            const url = document.getElementById('crear-url').value;
            if(nombre && precio) {
                const nuevo = { id: Date.now(), nombre, precioUSD: precio, foto: url || '', stock: "Nuevo" };
                misProductos.push(nuevo);
                localStorage.setItem('app_productos', JSON.stringify(misProductos));
                renderizarCatalogo();
                cerrarModal('modal-crear');
            }
        }

        function borrarProducto(id) {
            if(confirm("¿Eliminar producto?")) {
                misProductos = misProductos.filter(p => p.id !== id);
                localStorage.setItem('app_productos', JSON.stringify(misProductos));
                renderizarCatalogo();
            }
        }

        function procesarCompra() {
            if(miCarrito.length === 0) return;
            const totalUSD = miCarrito.reduce((s, p) => s + p.precioUSD, 0);
            const venta = { fecha: new Date().toLocaleDateString(), cant: miCarrito.length, usd: totalUSD };
            misVentas.push(venta);
            localStorage.setItem('app_ventas', JSON.stringify(misVentas));
            miCarrito = [];
            document.getElementById('cart-count').innerText = 0;
            renderizarCarrito();
            toggleCarrito();
            renderizarVentas();
            irSeccion('ventas');
        }

        function renderizarVentas() {
            const tbody = document.getElementById('tabla-ventas');
            tbody.innerHTML = '';
            let tUSD = 0;
            misVentas.forEach((v, i) => {
                tUSD += v.usd;
                tbody.innerHTML += `<tr>
                    <td>${v.fecha}</td>
                    <td>${v.cant}</td>
                    <td>$${v.usd.toFixed(2)}</td>
                    <td><button onclick="borrarVenta(${i})" style="color:red;">Borrar</button></td>
                </tr>`;
            });
            document.getElementById('total-usd').innerText = `$${tUSD.toFixed(2)}`;
            document.getElementById('total-bs').innerText = `Bs. ${(tUSD * miTasa).toFixed(2)}`;
        }

        function borrarVenta(i) {
            misVentas.splice(i, 1);
            localStorage.setItem('app_ventas', JSON.stringify(misVentas));
            renderizarVentas();
        }
    </script>
</body>
</html>
